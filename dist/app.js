(()=>{var ut=Object.create;var J=Object.defineProperty;var ct=Object.getOwnPropertyDescriptor;var mt=Object.getOwnPropertyNames;var dt=Object.getPrototypeOf,ft=Object.prototype.hasOwnProperty;var pt=(i,t)=>()=>(t||i((t={exports:{}}).exports,t),t.exports);var Ct=(i,t,e,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of mt(t))!ft.call(i,n)&&n!==e&&J(i,n,{get:()=>t[n],enumerable:!(s=ct(t,n))||s.enumerable});return i};var Q=(i,t,e)=>(e=i!=null?ut(dt(i)):{},Ct(t||!i||!i.__esModule?J(e,"default",{value:i,enumerable:!0}):e,i));var V=(i,t,e)=>{if(!t.has(i))throw TypeError("Cannot "+e)};var r=(i,t,e)=>(V(i,t,"read from private field"),e?e.call(i):t.get(i)),l=(i,t,e)=>{if(t.has(i))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(i):t.set(i,e)},h=(i,t,e,s)=>(V(i,t,"write to private field"),s?s.call(i,e):t.set(i,e),e);var B=pt(o=>{"use strict";var D,gt=o&&o.__classPrivateFieldSet||function(i,t,e,s,n){if(s==="m")throw new TypeError("Private method is not writable");if(s==="a"&&!n)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?i!==t||!n:!t.has(i))throw new TypeError("Cannot write private member to an object whose class did not declare it");return s==="a"?n.call(i,e):n?n.value=e:t.set(i,e),e},bt=o&&o.__classPrivateFieldGet||function(i,t,e,s){if(e==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?i!==t||!s:!t.has(i))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e==="m"?s:e==="a"?s.call(i):s?s.value:t.get(i)};Object.defineProperty(o,"__esModule",{value:!0}),o.Element=o.t=o.s=o.removeClass=o.onEach=o.once=o.on=o.off=o.hasClass=o.empty=o.emitCustom=o.emit=o.addClass=void 0;o.addClass=(i,...t)=>i.classList.add(...t);o.emit=(i,t)=>i.dispatchEvent(t);o.emitCustom=(i,t,...e)=>(0,o.emit)(i,new CustomEvent(t,{detail:e}));o.empty=i=>{for(var t;i.hasChildNodes();)(t=i.firstChild)===null||t===void 0||t.remove()};o.hasClass=(i,t)=>i.classList.contains(t);o.off=(i,t,e,s={})=>i.removeEventListener(t,e,s);o.on=(i,t,e,s={})=>i.addEventListener(t,e,s);o.once=(i,t,e,s={})=>(0,o.on)(i,t,e,Object.assign(Object.assign({},typeof s=="boolean"?{capture:s}:s),{once:!0}));o.onEach=(i,t,e,s={})=>t.forEach(n=>(0,o.on)(i,n,e,s));o.removeClass=(i,...t)=>i.classList.remove(...t);o.s=i=>{let t=document.createElement("div");return t.innerHTML=i,t.firstElementChild};o.t=i=>document.createTextNode(i);var b=class{constructor(t){D.set(this,void 0),gt(this,D,t,"f")}static fromString(t){return new b((0,o.s)(t))}addClass(...t){(0,o.addClass)(this.element(),...t)}append(...t){t.forEach(e=>{e instanceof b&&(e=e.element()),this.element().append(e)})}element(){return bt(this,D,"f")}emit(t){return(0,o.emit)(this.element(),t)}emitCustom(t,...e){return(0,o.emitCustom)(this.element(),t,...e)}empty(){(0,o.empty)(this.element())}hasClass(t){return(0,o.hasClass)(this.element(),t)}on(t,e,s={}){(0,o.on)(this.element(),t,e,s)}off(t,e,s={}){(0,o.off)(this.element(),t,e,s)}once(t,e,s={}){(0,o.once)(this.element(),t,e,s)}onEach(t,e,s={}){(0,o.onEach)(this.element(),t,e,s)}query(t){return this.element().querySelector(t)}queryAll(t){return this.element().querySelectorAll(t)}removeClass(...t){(0,o.removeClass)(this.element(),...t)}};o.Element=b,D=new WeakMap,o.default=b});var Z=(a=>(a[a.NONE=null]="NONE",a[a.RED=1]="RED",a[a.GREEN=2]="GREEN",a[a.BLUE=3]="BLUE",a[a.YELLOW=4]="YELLOW",a[a.ORANGE=5]="ORANGE",a[a.LIGHT_BLUE=6]="LIGHT_BLUE",a[a.PINK=7]="PINK",a[a.MAROON=8]="MAROON",a[a.PURPLE=9]="PURPLE",a[a.WHITE=10]="WHITE",a[a.GREY=11]="GREY",a[a.LIGHT_GREEN=12]="LIGHT_GREEN",a[a.BEIGE=13]="BEIGE",a[a.DARK_BLUE=14]="DARK_BLUE",a[a.TEAL=15]="TEAL",a[a.DARK_PINK=16]="DARK_PINK",a))(Z||{}),Et={[1]:"red",[2]:"green",[3]:"blue",[4]:"yellow",[5]:"orange",[6]:"light-blue",[7]:"pink",[8]:"maroon",[9]:"purple",[10]:"white",[11]:"grey",[12]:"light-green",[13]:"beige",[14]:"dark-blue",[15]:"teal",[16]:"dark-pink"},U=(...i)=>i.map(t=>Et[t]),p=Z;var tt=Q(B()),R=Q(B()),j=class extends tt.default{attr(t,e=""){this.element().setAttribute(t,e)}removeAttr(t){!this.element().hasAttribute(t)||this.element().removeAttribute(t)}},_=j;var v,f,y,K=class extends _{constructor(e){super((0,R.s)('<div class="cell"></div>'));l(this,v,p.NONE);l(this,f,[]);l(this,y,void 0);h(this,y,e)}colour(){return r(this,v)}index(){return r(this,y)}setColour(e){r(this,v)&&this.removeClass(...U(r(this,v))),h(this,v,e),e&&this.addClass(...U(e))}addConnection(e){r(this,f).includes(e)||(r(this,f).push(e),this.attr("data-connections",r(this,f).join(" ")))}dropConnection(e){let s=r(this,f).indexOf(e);if(s!==-1){if(r(this,f).splice(s,1),r(this,f).length===0){this.removeAttr("data-connections");return}this.attr("data-connections",r(this,f).join(" "))}}setFinal(e){if(e){this.attr("data-final");return}this.removeAttr("data-final")}};v=new WeakMap,f=new WeakMap,y=new WeakMap;var H=K;var Y=class extends H{constructor(t,e){super(t),super.setColour(e),this.addClass("point")}setColour(t){throw new TypeError("Cannot change the colour of a Point")}},c=Y;var q=(i,t,e,s)=>{let n=i.index()%s-t.index()%s,u=Math.floor(i.index()/s)-Math.floor(t.index()/s);return n===-1&&u===0?"l":n===1&&u===0?"r":n===0&&u===-1?"t":n===0&&u===1?"b":!1};var m,w,A,L,W=class{constructor(t,e){l(this,m,[]);l(this,w,void 0);l(this,A,void 0);l(this,L,0);h(this,w,t),h(this,A,e)}breakAt(t){if(!this.includes(t))return;let e=r(this,m).indexOf(t),s=r(this,m).slice(0,e);for(r(this,m).slice(e).length>s.length&&this.first()instanceof c&&this.last()instanceof c&&r(this,m).reverse();this.last()!==t;)this.pop()}canAdd(t){let e=this.last();return e===null?t instanceof c:this.complete()?!1:this.isNeighbour(e,t)&&(!(t instanceof c)||t.colour()===this.colour())}clear(){for(;this.last();)this.pop()}colour(){return r(this,w)}complete(){let t=this.first(),e=this.last();return this.length()>1&&t&&e&&t!==e&&t instanceof c&&e instanceof c}first(){return this.length()===0?null:r(this,m)[0]}includes(t){return r(this,m).includes(t)}isNeighbour(t,e){return q(t,e,r(this,A).height(),r(this,A).width())}last(){return this.length()===0?null:r(this,m)[this.length()-1]}length(){return r(this,m).length}pop(){if(this.length()===0)return;let t=this.complete(),e=r(this,m).pop(),s=this.last();e instanceof c||e.setColour(p.NONE),e.setFinal(!1),s&&(s.dropConnection(this.isNeighbour(e,s)),e.dropConnection(this.isNeighbour(s,e))),t&&(e.setFinal(!1),r(this,m).forEach(n=>n.setFinal(!1)),this.setStatus(0))}push(t){let e=this.last();e&&!this.canAdd(t)||(r(this,m).push(t),t instanceof c||t.setColour(r(this,w)),e&&(e.addConnection(this.isNeighbour(t,e)),t.addConnection(this.isNeighbour(e,t))),this.complete()&&this.setStatus(2))}setStatus(t){if(!(r(this,L)===2&&t===1)){if(h(this,L,t),t===0){r(this,m).forEach(e=>e.setFinal(!1));return}r(this,m).forEach(e=>e.setFinal(!0))}}status(){return r(this,L)}};m=new WeakMap,w=new WeakMap,A=new WeakMap,L=new WeakMap;var et=W;var st=(i,t=[])=>({cell:i,stack:t}),E,O,F,P,T,M,N,S,z=class{constructor(t,e,s){l(this,E,[]);l(this,O,void 0);l(this,F,void 0);l(this,P,void 0);l(this,T,new Map);l(this,M,[]);l(this,N,[]);l(this,S,void 0);h(this,F,e),h(this,P,t),h(this,S,s),h(this,O,t.cells()),r(this,N).push(st(e))}generate(){for(;r(this,N).length;){let t=r(this,N).shift(),{cell:e}=t;r(this,M).includes(e)||(this.neighboursOf(e).forEach(s=>{if(s instanceof c&&r(this,F).colour()!==s.colour()||t.stack.includes(s))return;let n=st(s,[...t.stack,e]);if(s===r(this,S)){r(this,E).push(n.stack);return}r(this,N).push(n)}),r(this,M).push(e))}}isNeighbour(t,e){return q(t,e,r(this,P).height(),r(this,P).width())}isPathAvailable(){return r(this,E).length===0&&this.generate(),r(this,E).length>0}neighboursOf(t){return r(this,T).has(t)||r(this,T).set(t,r(this,O).filter(e=>this.isNeighbour(t,e)!==!1)),r(this,T).get(t)}shortestPath(){r(this,E).length===0&&this.generate();let[t]=r(this,E).sort((e,s)=>e.length-s.length);return t}};E=new WeakMap,O=new WeakMap,F=new WeakMap,P=new WeakMap,T=new WeakMap,M=new WeakMap,N=new WeakMap,S=new WeakMap;var it=z;var x,d,g,I,G,X=class extends _{constructor(e,s,n=[]){super((0,R.s)('<div class="grid"></div>'));l(this,x,new Map);l(this,d,null);l(this,g,new Map);l(this,I,void 0);l(this,G,void 0);this.setSize(e,s),n.forEach(u=>{r(this,x).set(u.element(),u),this.append(u)}),this.bindEvents()}bindEvents(){this.on("pointerdown",e=>{if(!e.isPrimary)return;e.preventDefault();let s=this.cellFromEvent(e);if(s===null)return;let n=this.pathFromCell(s);if(n&&n.complete()&&n.last()===s){h(this,d,n),n.setStatus(0),n.clear(),n.push(s);return}if(n&&n.last()!==s){h(this,d,n),n.setStatus(0),n.breakAt(s);return}if(n&&n.last()===s){h(this,d,n),n.setStatus(0);return}if(!(s instanceof c))return;let u=new et(s.colour(),this);h(this,d,u),r(this,g).set(u.colour(),u)}),this.on("pointermove",e=>{if(e instanceof MouseEvent&&!e.buttons)return;let s=this.cellFromEvent(e),n=r(this,d);s===null||n===null||n&&n.status()===2&&!n.includes(s)||n.last()===s||this.handleAddCellToCurrentPath(s)},{passive:!0}),this.on("pointerup",()=>{r(this,d)!==null&&(r(this,d).setStatus(1),r(this,d).length()<2&&(r(this,d).clear(),r(this,g).delete(r(this,d).colour())),h(this,d,null))})}cells(){return Array.from(r(this,x).values())}cellFromEvent(e){var s;return(s=r(this,x).get(document.elementFromPoint(e.pageX,e.pageY)))!=null?s:null}handleAddCellToCurrentPath(e){let s=this.pathFromCell(e,r(this,d)),n=r(this,d);if(s&&s!==n&&!(e instanceof c)&&(s.breakAt(e),s.pop()),n.includes(e)&&n.last()!==e&&n.breakAt(e),n.canAdd(e)){n.push(e);return}let u=n.last();if(!u)return;let C=new it(this,u,e);C.isPathAvailable()&&C.shortestPath().forEach(ht=>this.handleAddCellToCurrentPath(ht))}height(){return r(this,I)}pathFromCell(e,s=null){let n=null;return r(this,g).forEach(u=>{n||u.includes(e)&&(n=u)}),n===null&&e instanceof c&&r(this,g).has(e.colour())&&(n=r(this,g).get(e.colour()),n!==s&&!n.canAdd(e)&&n.clear()),n}setSize(e,s){h(this,I,e),h(this,G,s),this.element().style.setProperty("--height",e.toString()),this.element().style.setProperty("--width",s.toString())}width(){return r(this,G)}};x=new WeakMap,d=new WeakMap,g=new WeakMap,I=new WeakMap,G=new WeakMap;var rt=X;var nt=[[3,3,"a1abc2bc"],[8,8,"2b7gfe5d10d1f3b1g2e1c2ca1h3a5h"],[15,15,"4o1i9l6a11eb5g5e20j2g26n9f1f9l7h1o7n10j7c6pd3mc4h5p6im3kad23b2k]"],[6,5,"1d2a4b2b1c2c10da"]];var ot=(i,t,e)=>{let s=e.match(/\d+|[a-z]/gi);if(s===null)throw new TypeError("Invalid level definition");let n=s.flatMap(C=>{if(/^\d+$/.test(C))return new Array(parseInt(C)).fill(p.NONE);if(/^[a-z]/i.test(C))return parseInt(C,36)-9;throw new TypeError(`Unknown level data '${C}'.`)}),u=i*t;return n.length<u&&n.push(...new Array(u-n.length).fill(p.NONE)),[i,t,n]},k,$=class{constructor(t){l(this,k,void 0);h(this,k,t)}generate(t=-1,e=-1,s=2){return ot(...nt[Math.floor(Math.random()*nt.length)])}fromURL(){let[t,e,s]=JSON.parse(atob(r(this,k).hash.slice(1)));return ot(t,e,s)}};k=new WeakMap;var at=$;var lt=new at(location),[vt,Nt,wt]=location.hash.length>1?lt.fromURL():lt.generate(),At=new rt(vt,Nt,wt.map((i,t)=>i===p.NONE?new H(t):new c(t,i))),Lt=document.getElementById("app");Lt.append(At.element());})();
//# sourceMappingURL=app.js.map
