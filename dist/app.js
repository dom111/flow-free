(()=>{var wt=Object.create;var it=Object.defineProperty;var At=Object.getOwnPropertyDescriptor;var Tt=Object.getOwnPropertyNames;var Lt=Object.getPrototypeOf,Pt=Object.prototype.hasOwnProperty;var R=Math.pow;var yt=(i,e)=>()=>(e||i((e={exports:{}}).exports,e),e.exports);var xt=(i,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of Tt(e))!Pt.call(i,o)&&o!==t&&it(i,o,{get:()=>e[o],enumerable:!(r=At(e,o))||r.enumerable});return i};var ot=(i,e,t)=>(t=i!=null?wt(Lt(i)):{},xt(e||!i||!i.__esModule?it(t,"default",{value:i,enumerable:!0}):t,i));var nt=(i,e,t)=>{if(!e.has(i))throw TypeError("Cannot "+t)};var s=(i,e,t)=>(nt(i,e,"read from private field"),t?t.call(i):e.get(i)),l=(i,e,t)=>{if(e.has(i))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(i):e.set(i,t)},h=(i,e,t,r)=>(nt(i,e,"write to private field"),r?r.call(i,t):e.set(i,t),t);var W=yt(n=>{"use strict";var K,Ft=n&&n.__classPrivateFieldSet||function(i,e,t,r,o){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!o)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?i!==e||!o:!e.has(i))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?o.call(i,t):o?o.value=t:e.set(i,t),t},Dt=n&&n.__classPrivateFieldGet||function(i,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?i!==e||!r:!e.has(i))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(i):r?r.value:e.get(i)};Object.defineProperty(n,"__esModule",{value:!0}),n.Element=n.t=n.s=n.removeClass=n.onEach=n.once=n.on=n.off=n.hasClass=n.empty=n.emitCustom=n.emit=n.addClass=void 0;n.addClass=(i,...e)=>i.classList.add(...e);n.emit=(i,e)=>i.dispatchEvent(e);n.emitCustom=(i,e,...t)=>(0,n.emit)(i,new CustomEvent(e,{detail:t}));n.empty=i=>{for(var e;i.hasChildNodes();)(e=i.firstChild)===null||e===void 0||e.remove()};n.hasClass=(i,e)=>i.classList.contains(e);n.off=(i,e,t,r={})=>i.removeEventListener(e,t,r);n.on=(i,e,t,r={})=>i.addEventListener(e,t,r);n.once=(i,e,t,r={})=>(0,n.on)(i,e,t,Object.assign(Object.assign({},typeof r=="boolean"?{capture:r}:r),{once:!0}));n.onEach=(i,e,t,r={})=>e.forEach(o=>(0,n.on)(i,o,t,r));n.removeClass=(i,...e)=>i.classList.remove(...e);n.s=i=>{let e=document.createElement("div");return e.innerHTML=i,e.firstElementChild};n.t=i=>document.createTextNode(i);var N=class{constructor(e){K.set(this,void 0),Ft(this,K,e,"f")}static fromString(e){return new N((0,n.s)(e))}addClass(...e){(0,n.addClass)(this.element(),...e)}append(...e){e.forEach(t=>{t instanceof N&&(t=t.element()),this.element().append(t)})}element(){return Dt(this,K,"f")}emit(e){return(0,n.emit)(this.element(),e)}emitCustom(e,...t){return(0,n.emitCustom)(this.element(),e,...t)}empty(){(0,n.empty)(this.element())}hasClass(e){return(0,n.hasClass)(this.element(),e)}on(e,t,r={}){(0,n.on)(this.element(),e,t,r)}off(e,t,r={}){(0,n.off)(this.element(),e,t,r)}once(e,t,r={}){(0,n.once)(this.element(),e,t,r)}onEach(e,t,r={}){(0,n.onEach)(this.element(),e,t,r)}query(e){return this.element().querySelector(e)}queryAll(e){return this.element().querySelectorAll(e)}removeClass(...e){(0,n.removeClass)(this.element(),...e)}};n.Element=N,K=new WeakMap,n.default=N});var q=(m=>(m[m.NONE=0]="NONE",m.RED="a",m.GREEN="b",m.BLUE="c",m.YELLOW="d",m.ORANGE="e",m.LIGHT_BLUE="f",m.PINK="g",m.MAROON="h",m.PURPLE="i",m.WHITE="j",m.GREY="k",m.LIGHT_GREEN="l",m.BEIGE="m",m.DARK_BLUE="n",m.TEAL="o",m.DARK_PINK="p",m))(q||{}),Ot={["a"]:"red",["b"]:"green",["c"]:"blue",["d"]:"yellow",["e"]:"orange",["f"]:"light-blue",["g"]:"pink",["h"]:"maroon",["i"]:"purple",["j"]:"white",["k"]:"grey",["l"]:"light-green",["m"]:"beige",["n"]:"dark-blue",["o"]:"teal",["p"]:"dark-pink"},lt=i=>{if(!Object.values(q).includes(i))throw new TypeError(`Unknown Colour '${i}'.`);return i},L=(...i)=>i.filter(e=>e!==0).map(e=>Ot[e]),p=q;var at=ot(W()),w=ot(W()),z=class extends at.default{attr(e,t=""){this.element().setAttribute(e,t)}removeAttr(e){!this.element().hasAttribute(e)||this.element().removeAttribute(e)}},P=z;var A,g,I,$=class extends P{constructor(t){super((0,w.s)('<div class="cell"></div>'));l(this,A,p.NONE);l(this,g,[]);l(this,I,void 0);h(this,I,t)}colour(){return s(this,A)}index(){return s(this,I)}setColour(t){s(this,A)&&this.removeClass(...L(s(this,A))),h(this,A,t),t&&this.addClass(...L(t))}addConnection(t){s(this,g).includes(t)||(s(this,g).push(t),this.attr("data-connections",s(this,g).join(" ")))}dropConnection(t){let r=s(this,g).indexOf(t);if(r!==-1){if(s(this,g).splice(r,1),s(this,g).length===0){this.removeAttr("data-connections");return}this.attr("data-connections",s(this,g).join(" "))}}setFinal(t){if(t){this.attr("data-final");return}this.removeAttr("data-final")}};A=new WeakMap,g=new WeakMap,I=new WeakMap;var X=$;var V=class extends X{constructor(e,t){super(e),super.setColour(t),this.addClass("point")}setColour(e){throw new TypeError("Cannot change the colour of a Point")}},u=V;var Q=(i,e,t,r)=>{let o=i.index()%r-e.index()%r,a=Math.floor(i.index()/r)-Math.floor(e.index()/r);return o===-1&&a===0?"l":o===1&&a===0?"r":o===0&&a===-1?"t":o===0&&a===1?"b":!1};var f,y,x,O,J=class{constructor(e,t){l(this,f,[]);l(this,y,void 0);l(this,x,void 0);l(this,O,0);h(this,y,e),h(this,x,t)}breakAt(e){if(!this.includes(e))return;let t=s(this,f).indexOf(e),r=s(this,f).slice(0,t);for(s(this,f).slice(t).length>r.length&&this.first()instanceof u&&this.last()instanceof u&&s(this,f).reverse();this.last()!==e;)this.pop()}canAdd(e){let t=this.last();return t===null?e instanceof u:this.complete()?!1:this.isNeighbour(t,e)&&(!(e instanceof u)||e.colour()===this.colour())}clear(){for(;this.last();)this.pop()}colour(){return s(this,y)}complete(){let e=this.first(),t=this.last();return this.length()>1&&e&&t&&e!==t&&e instanceof u&&t instanceof u}first(){return this.length()===0?null:s(this,f)[0]}includes(e){return s(this,f).includes(e)}isNeighbour(e,t){return Q(e,t,s(this,x).height(),s(this,x).width())}last(){return this.length()===0?null:s(this,f)[this.length()-1]}length(){return s(this,f).length}pop(){if(this.length()===0)return;let e=this.complete(),t=s(this,f).pop(),r=this.last();t instanceof u||t.setColour(p.NONE),t.setFinal(!1),r&&(r.dropConnection(this.isNeighbour(t,r)),t.dropConnection(this.isNeighbour(r,t))),e&&(t.setFinal(!1),s(this,f).forEach(o=>o.setFinal(!1)),this.setStatus(0))}push(e){let t=this.last();t&&!this.canAdd(e)||(s(this,f).push(e),e instanceof u||e.setColour(s(this,y)),t&&(t.addConnection(this.isNeighbour(e,t)),e.addConnection(this.isNeighbour(t,e))))}setStatus(e){if(!(s(this,O)===2&&e===1)){if(h(this,O,e),e===0){s(this,f).forEach(t=>t.setFinal(!1));return}s(this,f).forEach(t=>t.setFinal(!0))}}status(){return s(this,O)}};f=new WeakMap,y=new WeakMap,x=new WeakMap,O=new WeakMap;var ht=J;var ut=(i,e=[])=>({cell:i,stack:e}),E,G,k,F,D,H,T,U,Z=class{constructor(e,t,r){l(this,E,[]);l(this,G,void 0);l(this,k,void 0);l(this,F,void 0);l(this,D,new Map);l(this,H,[]);l(this,T,[]);l(this,U,void 0);h(this,k,t),h(this,F,e),h(this,U,r),h(this,G,e.cells()),s(this,T).push(ut(t))}generate(){for(;s(this,T).length;){let e=s(this,T).shift(),{cell:t}=e;s(this,H).includes(t)||(this.neighboursOf(t).forEach(r=>{if(r instanceof u&&s(this,k).colour()!==r.colour()||e.stack.includes(r))return;let o=ut(r,[...e.stack,t]);if(r===s(this,U)){s(this,E).push(o.stack.concat([r]));return}s(this,T).push(o)}),s(this,H).push(t))}}isNeighbour(e,t){return Q(e,t,s(this,F).height(),s(this,F).width())}isPathAvailable(){return s(this,E).length===0&&this.generate(),s(this,E).length>0}neighboursOf(e){return s(this,D).has(e)||s(this,D).set(e,s(this,G).filter(t=>this.isNeighbour(e,t)!==!1)),s(this,D).get(e)}shortestPath(){s(this,E).length===0&&this.generate();let[e]=s(this,E).sort((t,r)=>t.length-r.length);return e}};E=new WeakMap,G=new WeakMap,k=new WeakMap,F=new WeakMap,D=new WeakMap,H=new WeakMap,T=new WeakMap,U=new WeakMap;var ct=Z;var St={[0]:"default",[1]:"good",[2]:"invalid"},mt=i=>St[i],S,_,tt=class extends P{constructor(t,r){super((0,w.s)('<div class="touch-highlight"></div>'));l(this,S,p.NONE);l(this,_,0);this.element().style.setProperty("--height",t.toString()),this.element().style.setProperty("--width",r.toString())}getTopLeftFromEvent(t){return t instanceof TouchEvent?[t.touches[0].pageX-Math.sqrt(R(t.touches[0].radiusX,2)+R(t.touches[0].radiusY,2)),t.touches[0].pageY-Math.sqrt(R(t.touches[0].radiusX,2)+R(t.touches[0].radiusY,2))]:[t.pageX,t.pageY]}move(t){let[r,o]=this.getTopLeftFromEvent(t);this.element().style.left=r+"px",this.element().style.top=o+"px"}setColour(t){s(this,S)!==p.NONE&&this.removeClass(...L(s(this,S))),h(this,S,t),t!==p.NONE&&this.addClass(...L(t))}setStatus(t){this.removeClass(mt(s(this,_))),h(this,_,t),this.addClass(mt(t))}};S=new WeakMap,_=new WeakMap;var dt=tt;var M,c,v,j,C,Y,et=class extends P{constructor(t,r,o,a){super((0,w.s)('<div class="grid"></div>'));l(this,M,new Map);l(this,c,null);l(this,v,new Map);l(this,j,void 0);l(this,C,void 0);l(this,Y,void 0);this.setSize(t,r),o.forEach(d=>{s(this,M).set(d.element(),d),this.append(d)}),h(this,C,a),this.bindEvents()}bindEvents(){this.on("pointerdown",t=>{if(!t.isPrimary)return;t.preventDefault();let r=this.cellFromEvent(t);if(r===null)return;let o=this.pathFromCell(r);if(o&&o.complete()&&o.last()===r){h(this,c,o),o.setStatus(0),o.clear(),o.push(r),s(this,C).setColour(o.colour());return}if(o&&o.last()!==r){h(this,c,o),o.setStatus(0),o.breakAt(r),s(this,C).setColour(o.colour());return}if(o&&o.last()===r){h(this,c,o),o.setStatus(0),s(this,C).setColour(o.colour());return}if(!(r instanceof u))return;let a=new ht(r.colour(),this);h(this,c,a),s(this,C).setColour(a.colour()),a.push(r),s(this,v).set(a.colour(),a)}),this.on("pointermove",t=>this.handleHighlight(t,this.cellFromEvent(t))),this.on("touchmove",t=>{t.preventDefault();let r=this.cellFromEvent(t),o=s(this,c);this.handleHighlight(t,r),!(r===null||o===null||o&&o.status()===2&&!o.includes(r)||o.last()===r)&&this.handleAddCellToCurrentPath(r)}),this.on("pointerenter",t=>{if(!t.isPrimary)return;t.preventDefault();let r=this.cellFromEvent(t),o=s(this,c);r===null||o===null||o&&o.status()===2&&!o.includes(r)||o.last()===r||this.handleAddCellToCurrentPath(r)},{capture:!0}),this.on("pointerup",t=>{s(this,c)!==null&&(t.preventDefault(),s(this,c).setStatus(1),s(this,c).length()<2&&(s(this,c).clear(),s(this,v).delete(s(this,c).colour())),h(this,c,null),s(this,C).setColour(p.NONE))})}cells(){return Array.from(s(this,M).values())}cellFromEvent(t){var r;return(r=s(this,M).get(document.elementFromPoint(t instanceof TouchEvent?t.touches[0].pageX:t.pageX,t instanceof TouchEvent?t.touches[0].pageY:t.pageY)))!=null?r:null}handleAddCellToCurrentPath(t){let r=this.pathFromCell(t,s(this,c)),o=s(this,c);if(r&&r!==o&&!(t instanceof u)&&(r.breakAt(t),r.pop()),o.includes(t)&&o.last()!==t&&o.breakAt(t),o.canAdd(t)){o.push(t);return}let a=o.last();if(!a)return;let d=new ct(this,a,t);d.isPathAvailable()&&d.shortestPath().forEach(b=>this.handleAddCellToCurrentPath(b))}handleHighlight(t,r){var o,a,d;s(this,C).move(t),r instanceof u&&((o=s(this,c))==null?void 0:o.length())>1&&((a=s(this,c))==null?void 0:a.first())!==r&&s(this,C).setStatus(1),r instanceof u&&r.colour()!==((d=s(this,c))==null?void 0:d.colour())&&s(this,C).setStatus(2),r instanceof u||s(this,C).setStatus(0)}height(){return s(this,j)}pathFromCell(t,r=null){let o=null;return s(this,v).forEach(a=>{o||a.includes(t)&&(o=a)}),o===null&&t instanceof u&&s(this,v).has(t.colour())&&(o=s(this,v).get(t.colour()),o!==r&&!o.canAdd(t)&&o.clear()),o}setSize(t,r){h(this,j,t),h(this,Y,r),this.element().style.setProperty("--height",t.toString()),this.element().style.setProperty("--width",r.toString())}width(){return s(this,Y)}};M=new WeakMap,c=new WeakMap,v=new WeakMap,j=new WeakMap,C=new WeakMap,Y=new WeakMap;var ft=et;var pt=[[3,3,"a1abc2bc"],[8,8,"2b7gfe5d10d1f3b1g2e1c2ca1h3a5h"],[15,15,"4o1i9l6a11eb5g5e20j2g26n9f1f9l7h1o7n10j7c6pd3mc4h5p6im3kad23b2k]"],[6,5,"1d2a4b2b1c2c10da"]];var Ct=(i,e,t)=>{let r=t.match(/\d+|[a-z]/gi);if(r===null)throw new TypeError("Invalid level definition");let o=r.flatMap(d=>{if(/^\d+$/.test(d))return new Array(parseInt(d,10)).fill(p.NONE);if(/^[a-z]$/i.test(d))return lt(d);throw new TypeError(`Unknown level data '${d}'.`)}),a=i*e;return o.length<a&&o.push(...new Array(a-o.length).fill(p.NONE)),[i,e,o]},B,rt=class{constructor(e){l(this,B,void 0);h(this,B,e)}generate(e=-1,t=-1,r=2){return Ct(...pt[Math.floor(Math.random()*pt.length)])}fromURL(){let e=decodeURIComponent(s(this,B).hash.slice(1));if(e.length<2)return null;let t;try{t=atob(e)}catch(b){if(!(b instanceof DOMException))throw b;t=e}if(!t)return null;let r;try{r=JSON.parse(t.replace(/'/g,'"'))}catch(b){if(!(b instanceof SyntaxError))throw b;return console.warn("Invalid JSON data provided: "+t),null}if(!(r instanceof Array)||r.length!==3||typeof r[0]!="number"||typeof r[1]!="number"||typeof r[2]!="string")return null;let[o,a,d]=r;return Ct(o,a,d)}};B=new WeakMap;var gt=rt;var Et=new gt(location),st=Et.fromURL(),[vt,bt,Mt]=st!=null?st:Et.generate(),Nt=new dt(vt,bt),Rt=new ft(vt,bt,Mt.map((i,e)=>i===p.NONE?new X(e):new u(e,i)),Nt),It=document.getElementById("app");It.append(Rt.element(),Nt.element());})();
//# sourceMappingURL=app.js.map
